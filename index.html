<html>
<head>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="apple-mobile-web-app-title" content="test">
  <!-- manifest.jsonを呼び出しています -->
  <link rel="manifest" href="./manifest.json">
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-analytics.js"></script>

<script>
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyAY_WM17RYD1wqdsOI77xC-8_jaS4Kx7uc",
    authDomain: "test-webpush-ae575.firebaseapp.com",
    databaseURL: "https://test-webpush-ae575.firebaseio.com",
    projectId: "test-webpush-ae575",
    storageBucket: "test-webpush-ae575.appspot.com",
    messagingSenderId: "855008810220",
    appId: "1:855008810220:web:2835eb7f3799bcb98081c9",
    measurementId: "G-JFQ3H8J4L2"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>
<script>
const messaging = firebase.messaging();

if ('serviceWorker' in navigator) {
    // サービスワーカー登録
    navigator.serviceWorker.register('./service-worker.js').then(function(registration) {
        // 成功した場合の処理
        console.log('サービスワーカーを登録しました。', registration.scope);
        // 登録処理
        messaging.useServiceWorker(registration);
        // 通知の受信許可確認
        messaging.requestPermission()
                 .then(function() {
                     console.log('通知の受信が許可されました。');
                     // トークンを取得する
                     messaging.getToken()
                              .then(function(currentToken) {
                                  if (currentToken) {
                                      // 通知許可を押下した場合、トークンをコンソール出力
                                      //ここは後でDBへ格納する処理などに変更しておきましょう
                                      console.log(currentToken);
                                  } else {
                                      console.log('トークンを取得できませんでした。権限を確認してください。');
                                  }
                              })
                              .catch(function(err) {
                                  console.log('トークンの取得中にエラーが発生しました。', err);
                              });
                 })
                 .catch(function(err) {
                     console.log('通知が許可されていません。', err);
                 });
    }).catch(function(err) {
        // サービスワーカー登録失敗
        console.log('サービスワーカーの登録に失敗しました。', err);
    });
}
</script>
  <title>Hello PWA.</title>
  <style>
    body {
      text-align:center;
      font-size: 40px;
      vertical-align: middle;
    }
    .image {
      width: 80%; 
      margin: auto;
      display: block;
    }
  </style>
</head>
<body>
  <h1>Hello PWA.</h1>
  <img src="./icons/freeicon-512.png" alt="PWA logo" class="image" />
  <a href="p.html">p.html</a>

</body>
</html>